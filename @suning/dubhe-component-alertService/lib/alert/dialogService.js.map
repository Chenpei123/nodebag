{"version":3,"sources":["../../src/alert/dialogService.js"],"names":["app","service","$http","$document","$rootScope","$compile","$q","$timeout","zIndex","dialogCounter","dialogMap","modal","param","data","defer","get","url","then","result","key","promise","mask","angular","element","find","append","addClass","css","dialog","newScope","$new","extend","clientHeight","document","documentElement","anim","resolve","accept","dismiss","refuse","reason","remove","removeClass","animCloseDelay","hide","show","dismissAll","postMessage","type","message","messageHandler","publicValue","timestamp","messagestamp","getValue","setValue","value","setStamp","stamp","getStamp"],"mappings":"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","file":"dialogService.js","sourcesContent":["import {dialogDrag} from './dialogDrag';\r\n\r\nexport default app => {\r\n    app.service(\"DialogService\", [\"$http\", \"$document\", \"$rootScope\", \"$compile\", '$q', '$timeout',\r\n        function ($http, $document, $rootScope, $compile, $q, $timeout) {\r\n            var zIndex = 1036;\r\n            var dialogCounter = 0;\r\n\r\n            var dialogMap = {};\r\n            return {\r\n                modal: function (param, data) {\r\n                    var defer = $q.defer();\r\n                    $http.get(param.url).then(function (result) {\r\n                        //dialogCounter += 2;\r\n                        dialogCounter = 2;\r\n                        dialogMap[param.key] = param;\r\n                        dialogMap[param.key].promise = defer.promise;\r\n\r\n                        var mask = angular.element('<div class=\"modal-backdrop fade in\"></div>');\r\n                        $document.find(\"body\").append(mask).addClass('overflow-hidden');\r\n                        mask.css(\"z-index\", zIndex + dialogCounter);\r\n\r\n                        dialogMap[param.key].mask = mask;\r\n\r\n                        var dialog = angular.element(result.data);\r\n                        var newScope = $rootScope.$new();\r\n                        if (data) {\r\n                            angular.extend(newScope, data);\r\n                        }\r\n                        var element = $compile(dialog)(newScope);\r\n                        var clientHeight = document.documentElement.clientHeight;\r\n\r\n                        $document.find(\"body\").append(element);\r\n                        element.css(\"display\", \"block\");\r\n                        element.css(\"z-index\", zIndex + dialogCounter + 1);\r\n                        element.find('.modal-content').css('max-height', clientHeight - 60).css('overflow-y', 'auto');\r\n\r\n                        // 如果配置了启动动画的属性，则延迟加入动画class\r\n                        param.anim && $timeout(function(){\r\n                            element.addClass('anim-start');\r\n                        },20);\r\n                        \r\n                        dialogDrag()(element);\r\n\r\n                        dialogMap[param.key].dialog = element;\r\n                        defer.resolve();\r\n                    });\r\n                },\r\n\r\n                accept: function (key, result) {\r\n                    this.dismiss(key);\r\n\r\n                    if (dialogMap[key].accept) {\r\n                        dialogMap[key].accept(result);\r\n                    }\r\n                },\r\n\r\n                refuse: function (key, reason) {\r\n                    this.dismiss(key);\r\n\r\n                    if (dialogMap[key].refuse) {\r\n                        dialogMap[key].refuse(reason);\r\n                    }\r\n                },\r\n\r\n                dismiss: function (key) {\r\n                    // 如果配置了启动动画的属性，则延迟加入动画class\r\n                    dialogMap[key].dialog.addClass('anim-end');\r\n                    if(dialogMap[key].anim) {\r\n                        $timeout(function(){\r\n                            dialogMap[key].mask.remove();\r\n                            dialogMap[key].dialog\r\n                                .removeClass('anim-start')\r\n                                .removeClass('anim-end')\r\n                                .remove();\r\n                        }, dialogMap[key].animCloseDelay || 1000);\r\n                    }else {\r\n                        dialogMap[key].mask.remove();\r\n                        dialogMap[key].dialog.remove();\r\n                    }\r\n                    $document.find(\"body\").removeClass('overflow-hidden');\r\n                },\r\n\r\n                hide: function (key) {\r\n                    dialogMap[key].promise.then(function () {\r\n                        dialogMap[key].mask.hide();\r\n                        dialogMap[key].dialog.hide();\r\n                    });\r\n                },\r\n\r\n                show: function (key) {\r\n                    dialogMap[key].mask && dialogMap[key].mask.show();\r\n                    dialogMap[key].dialog && dialogMap[key].dialog.show();\r\n                },\r\n\r\n                dismissAll: function () {\r\n                    for (var key in dialogMap) {\r\n                        this.dismiss(key);\r\n                    }\r\n                },\r\n\r\n                postMessage: function (key, type, message) {\r\n                    if (dialogMap[key].messageHandler) {\r\n                        if (dialogMap[key].messageHandler[type]) {\r\n                            dialogMap[key].messageHandler[type](message);\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n    }]);\r\n\r\n\r\n        //存值\r\n    app.service('serveAlert', function () {\r\n        var publicValue;\r\n        var timestamp;\r\n        var messagestamp;\r\n        return {\r\n            getValue: function () {\r\n                \r\n                return publicValue;\r\n            },\r\n            setValue: function (value) {\r\n                publicValue = value\r\n            },\r\n            setStamp: function (message,stamp) {\r\n                messagestamp = message\r\n                timestamp = stamp\r\n            },\r\n            getStamp: function () {\r\n                return {\"message\":messagestamp,\"stamp\":timestamp};\r\n            }\r\n        };\r\n\r\n    });\r\n\r\n\r\n\r\n}"]}