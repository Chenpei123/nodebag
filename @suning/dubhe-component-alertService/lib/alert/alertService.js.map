{"version":3,"sources":["../../src/alert/alertService.js"],"names":["alertTmpl","confirmTmpl","app","service","$http","$document","$q","$rootScope","$compile","serveAlert","zIndex","dialogCounter","alert","param","alertstamp","alertmessage","ifPass","getStamp","message","undefined","Date","parse","content","setStamp","judgeMark","stampNow","messageNow","stamp","defer","dialog","data","$new","extend","ok","dismiss","resolve","close","type","element","find","append","css","promise","confirm","cancel","reject","remove"],"mappings":"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","file":"alertService.js","sourcesContent":["import angular from 'angular';\r\nimport {dialogDrag} from './dialogDrag';\r\nlet alertTmpl = `\r\n<div class=\"modal fade in\">\r\n  <div class=\"modal-dialog alert-modal\">\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-body\">\r\n        <div class=\"alert-content\">\r\n          <h5 class=\"alert-title\" ng-switch=\"type\">\r\n            <i class=\"fa fa-info-circle text-light-blue\" ng-switch-when=\"info\"></i>\r\n            <i class=\"fa fa-exclamation-circle text-orange\" ng-switch-when=\"warning\"></i>\r\n            <i class=\"fa fa-check-circle text-green\" ng-switch-when=\"success\"></i>\r\n            <i class=\"fa fa-times-circle text-red\" ng-switch-when=\"error\"></i>\r\n            {{title}}\r\n          </h5>\r\n          <pre ng-bind-html=\"content\"></pre>\r\n        </div>\r\n      </div>\r\n      <div class=\"modal-footer\">\r\n        <button type=\"button\" class=\"btn btn-primary\" ng-click=\"close()\">知道了</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\t\t`;\r\nlet confirmTmpl = `\r\n<div class=\"modal fade in\">\r\n  <div class=\"modal-dialog\">\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <button type=\"button\" class=\"close\" ng-click=\"close()\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span>\r\n        </button>\r\n        <h4 class=\"modal-title\">{{title}}</h4>\r\n      </div>\r\n      <div class=\"modal-body\">\r\n        <div class=\"alert-content\">\r\n          <pre ng-bind-html=\"content\" style=\"background: inherit;border: none;\"></pre>\r\n        </div>\r\n      </div>\r\n      <div class=\"modal-footer\">\r\n        <button type=\"button\" class=\"btn btn-primary\" ng-show=\"ok\" ng-click=\"ok()\">确定</button>\r\n        <button type=\"button\" class=\"btn btn-primary reverse\" ng-show=\"cancel\" ng-click=\"cancel()\">取消</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\t\t`;\r\nexport default app => {\r\n    app.service(\"AlertService\", [\"$http\", \"$document\", \"$q\", \"$rootScope\", \"$compile\",\"serveAlert\",\r\n        function ($http, $document, $q, $rootScope, $compile,serveAlert) {\r\n       \r\n            var zIndex = 1200;\r\n            var dialogCounter = 0;\r\n\r\n            // var mask = angular.element('<div class=\"modal-backdrop fade in\"></div>');\r\n            // mask.css(\"z-index\", zIndex);\r\n\r\n            var service = {\r\n                alert: function (param) {\r\n                    var alertstamp;\r\n                    var alertmessage;\r\n                    var ifPass = true;\r\n                    if(serveAlert.getStamp().message == undefined){\r\n                        alertstamp = Date.parse( new Date());\r\n                        alertmessage = param.content;\r\n                        serveAlert.setStamp(alertmessage,alertstamp)\r\n                    }else{\r\n                        var judgeMark = serveAlert.getStamp();\r\n                        var stampNow = Date.parse( new Date());\r\n                        var messageNow = param.content;\r\n                        if((stampNow-judgeMark.stamp)<5*1000 && messageNow == judgeMark.message){\r\n                            ifPass = false;\r\n                        }\r\n                    }\r\n                    if(!ifPass){\r\n                        return;\r\n                    }\r\n                    var defer = $q.defer();\r\n                    var dialog;\r\n                    dialogCounter++;\r\n\r\n                    // if (dialogCounter == 1) {\r\n                    //   $document.find(\"body\").append(mask);\r\n                    // }\r\n\r\n                    var data = $rootScope.$new();\r\n                    angular.extend(data, param);\r\n\r\n                    data.ok = function () {\r\n                        service.dismiss(dialog);\r\n                        defer.resolve(\"ok\");\r\n                    };\r\n                    data.close = function () {\r\n                        service.dismiss(dialog);\r\n                        defer.resolve(\"ok\");\r\n                    };\r\n                    data.type = data.type || 'info';\r\n\r\n                    dialog = $compile(angular.element(alertTmpl))(data);\r\n\r\n                    $document.find(\"body\").append(dialog);\r\n                    dialog.css(\"display\", \"block\");\r\n                    dialog.css(\"z-index\", zIndex + dialogCounter);\r\n\r\n                    dialogDrag()(dialog);\r\n\r\n                    return defer.promise;\r\n                },\r\n                confirm: function (param) {\r\n                    var defer = $q.defer();\r\n\r\n                    var dialog;\r\n                    dialogCounter++;\r\n\r\n                    // if (dialogCounter == 1) {\r\n                    //   $document.find(\"body\").append(mask);\r\n                    // }\r\n\r\n                    var data = $rootScope.$new();\r\n                    angular.extend(data, param);\r\n\r\n                    data.ok = function () {\r\n                        service.dismiss(dialog);\r\n                        defer.resolve(\"ok\");\r\n                    };\r\n                    data.cancel = function () {\r\n                        service.dismiss(dialog);\r\n                        defer.reject(\"cancel\");\r\n                    };\r\n                    data.close = function () {\r\n                        service.dismiss(dialog);\r\n                        defer.reject(\"cancel\");\r\n                    };\r\n\r\n                    dialog = $compile(confirmTmpl)(data);\r\n\r\n                    $document.find(\"body\").append(dialog);\r\n                    dialog.css(\"display\", \"block\");\r\n                    dialog.css(\"z-index\", zIndex + dialogCounter);\r\n\r\n                    dialogDrag()(dialog);\r\n\r\n                    return defer.promise;\r\n                },\r\n                dismiss: function (dialog) {\r\n                    dialogCounter--;\r\n                    dialog.remove();\r\n\r\n                    if (dialogCounter == 0) {\r\n                        // mask.remove();\r\n                    }\r\n                }\r\n            };\r\n\r\n            return service;\r\n        }]);\r\n}"]}