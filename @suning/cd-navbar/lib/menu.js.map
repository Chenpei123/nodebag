{"version":3,"sources":["../src/menu.js"],"names":["stateGoFactory","scope","state","uiState","readonly","event","preventDefault","stopPropagation","go","uiStateParam","uiStateOpts","ifr","document","querySelector","src","contentWindow","location","href","app","directive","ctrl","$scope","$state","menus","$menus","$on","evt","toState","locateMenu","current","addMenu","push","menu","name","active","isMenuActive","menuState","exec","relations","relation","RegExp","test","children","length","filter","item","$inject","link","element","attrs","addClass","hasOwnProperty","hasClass","$","AdminLTE","layout","fix","fixSidebar","restrict","transclude","controller","template","$element","$timeout","$emit","gotoState","snMenu","parent","ul","find","liFirst","liList","ulist","mouseenter","removeClass","maxHeight","Math","max","apply","map","angular","height","concat","maxWidth","width","css","needCalcHeight","attr","undefined","open","transcludeFn","a","append","remove","$observe","value","replace","require","compile","post","snMenuItem","snMenuItem2"],"mappings":"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","file":"menu.js","sourcesContent":["import './menu.less';\r\n\r\nexport default app => {\r\n    function stateGoFactory(scope, state) {\r\n        return event => {\r\n            if (scope.uiState && !scope.readonly) {\r\n                event.preventDefault();\r\n                event.stopPropagation();\r\n                state.go(scope.uiState, scope.uiStateParam, scope.uiStateOpts);\r\n                // state.go(scope.uiState, scope.uiStateParam, {\r\n                //     reload: true,\r\n                //     notify: false\r\n                // });\r\n                let ifr = document.querySelector('.iframe-wrap>cd-iframe>iframe')\r\n                if (ifr && ifr.src !== ifr.contentWindow.location.href) {\r\n                    ifr.src = ifr.src\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    app.directive('snMenu', [() => {\r\n        let ctrl = function ($scope, $state) {\r\n            let menus = $scope.$menus = [];\r\n            // 路由切换后，定位菜单是否被命中\r\n            $scope.$on('router:state:change', (evt, toState) => {\r\n                locateMenu(toState);\r\n            });\r\n            // 菜单变更后，定位菜单是否被命中\r\n            $scope.$on('sn-menu:menu-change', evt => {\r\n                locateMenu($state.current);\r\n            });\r\n\r\n            this.addMenu = menu => {\r\n                menus.push(menu);\r\n                locateMenu($state.current);\r\n            };\r\n\r\n            function locateMenu(toState) {\r\n                let state = toState.name;\r\n                for (let menu of menus) {\r\n                    menu.active = isMenuActive(menu, state)\r\n                }\r\n            }\r\n\r\n            function isMenuActive(menu, state) {\r\n                let active = false;\r\n                let menuState = /.*(?=\\()/.exec(menu.uiState);\r\n                active = menu.uiState == state;\r\n                if (!active && menu.relations) {\r\n                    for (let relation of menu.relations) {\r\n                        active = active || ((relation instanceof RegExp) ? relation.test(state) : relation == state);\r\n                    }\r\n                };\r\n                if (menu.children && menu.children.length > 0) {\r\n                    active = menu.children.filter(item => {\r\n                        return isMenuActive(item, state);\r\n                    }).length || active;\r\n                }\r\n                menu.active = active;\r\n                return active;\r\n            }\r\n        };\r\n        ctrl.$inject = ['$scope', '$state'];\r\n\r\n        let link = function (scope, element, attrs) {\r\n            element.addClass('sn-menu');\r\n            // 如果是竖式菜单，并且包含主菜单标记main-menu，则需要监听事件，动态调整页面高度\r\n            if (attrs.hasOwnProperty('mainMenu') && element.hasClass('vertical')) {\r\n                scope.$on('router:state:change', (evt, toState) => {\r\n                    if ($.AdminLTE) {\r\n                        $.AdminLTE.layout.fix();\r\n                        $.AdminLTE.layout.fixSidebar();\r\n                    }\r\n                });\r\n\r\n                scope.$on('sn-menu:menu-change', evt => {\r\n                    if ($.AdminLTE) {\r\n                        $.AdminLTE.layout.fix();\r\n                        $.AdminLTE.layout.fixSidebar();\r\n                    }\r\n                });\r\n            }\r\n        };\r\n        return {\r\n            restrict: 'AE',\r\n            transclude: true,\r\n            scope: true,\r\n            controller: ctrl,\r\n            link: link,\r\n            template: `\r\n            <div class=\"navbar-menu\">\r\n  <ul class=\"nav navbar-nav\" ng-transclude></ul>\r\n</div>\r\n            `\r\n        }\r\n    }]);\r\n\r\n    app.directive('snMenuItem', [() => {\r\n        let ctrl = function ($scope, $element, $timeout, $state) {\r\n            $scope.children = [];\r\n            this.addMenu = menu => {\r\n                $scope.children.push(menu);\r\n                $scope.$emit('sn-menu:menu-change');\r\n            };\r\n            let gotoState = $scope.gotoState = stateGoFactory($scope, $state);\r\n            // 横向菜单的垂直2级菜单排布时，进行一些特殊处理\r\n            let snMenu = $element.parent().parent().parent();\r\n            if ($element.hasClass('vertical') && snMenu.hasClass('horizontal')) {\r\n                $timeout(() => {\r\n                    let ul = $element.find('> ul');\r\n                    let liFirst = ul.find('> li:first-child');\r\n                    let liList = ul.find('> li');\r\n                    let ulist = ul.find('> li > ul');\r\n\r\n                    // active样式控制\r\n                    $element.mouseenter(() => {\r\n                        liList.removeClass('active');\r\n                        liFirst.addClass('active');\r\n                    });\r\n                    liList.mouseenter(function () {\r\n                        liList.removeClass('active');\r\n                        $(this).addClass('active');\r\n                    });\r\n\r\n                    // 计算容器高度 宽度\r\n                    let maxHeight = Math.max.apply(null, Array.from(ulist).map(item => angular.element(item).height()).concat(ul.height()));\r\n                    let maxWidth = Math.max.apply(null, Array.from(ulist).map(item => angular.element(item).width()));\r\n                    // ul有border，占用2px的高度，所以+2补内容的高度\r\n                    ul.height(maxHeight + 3);\r\n                    ulist.height(maxHeight);\r\n                    ulist.width(maxWidth);\r\n\r\n                    // 右对齐特殊处理\r\n                    if ($element.hasClass('right-align')) {\r\n                        // jquery获取的宽度不包含margin、padding，这里根据less的设置进行补足\r\n                        ul.css('right', maxWidth + 60);\r\n                    }\r\n                }, 0);\r\n            }\r\n\r\n            // 竖式菜单的1级菜单特殊处理\r\n            if (snMenu.hasClass('vertical')) {\r\n                let needCalcHeight = snMenu.attr('main-menu') !== undefined;\r\n                $scope.gotoState = function (event) {\r\n                    $scope.open = !$scope.open;\r\n                    if (needCalcHeight && $.AdminLTE) {\r\n                        $timeout(() => {\r\n                            $.AdminLTE.layout.fix();\r\n                            $.AdminLTE.layout.fixSidebar();\r\n                        });\r\n                    }\r\n                    gotoState(event);\r\n                }\r\n            }\r\n        };\r\n        ctrl.$inject = ['$scope', '$element', '$timeout', '$state'];\r\n\r\n        let link = function (scope, element, attrs, snMenu, transcludeFn) {\r\n            element.addClass('sn-menu-item');\r\n            snMenu.addMenu(scope);\r\n            scope.open = element.hasClass('open');\r\n            let a = element.find('> a');\r\n            a.append(element.find('> ul > t').remove());\r\n            attrs.$observe('target', value => {\r\n                a.attr('target', value);\r\n            });\r\n        };\r\n        return {\r\n            restrict: 'AE',\r\n            transclude: true,\r\n            replace: true,\r\n            require: '^snMenu',\r\n            scope: {\r\n                href: '@',\r\n                uiState: '@',\r\n                readonly: '=',\r\n                uiStateParam: '=',\r\n                uiStateOpts: '=',\r\n                relations: '='\r\n            },\r\n            controller: ctrl,\r\n            compile: (element, attrs, transcludeFn) => {\r\n                let parent = element.parent();\r\n                if (parent.hasClass('horizontal')) {\r\n                    element.addClass('dropdown');\r\n                    element.find('> ul').addClass('dropdown-menu');\r\n                }\r\n                let a = element.find('> a');\r\n                return {\r\n                    post: link\r\n                }\r\n            },\r\n            template: `<li ng-class=\"{'active': active, 'open': open, 'readonly': readonly,                     'hasChildren': children && children.length > 0 }\">\r\n                            <a ng-click=\"gotoState($event)\" ng-href=\"{{readonly ? '' : href}}\">\r\n                                <i class=\"fa fa-angle-up pull-right\" ng-show=\"children && children.length > 0 && !open\"></i>\r\n                                <i class=\"fa fa-angle-down pull-right\" ng-show=\"children && children.length > 0 && open\"></i>\r\n                            </a>\r\n                            <ul ng-show=\"children && children.length > 0\" ng-transclude></ul>\r\n                        </li>`\r\n        }\r\n    }]);\r\n\r\n    app.directive('snMenuItem2', [() => {\r\n        let ctrl = function ($scope, $state) {\r\n            $scope.children = [];\r\n            this.addMenu = menu => {\r\n                $scope.children.push(menu);\r\n                $scope.$emit('sn-menu:menu-change');\r\n            };\r\n            $scope.gotoState = stateGoFactory($scope, $state);\r\n        };\r\n        ctrl.$inject = ['$scope', '$state'];\r\n\r\n        let link = function (scope, element, attrs, snMenuItem, transcludeFn) {\r\n            element.addClass('sn-menu-item2');\r\n            snMenuItem.addMenu(scope);\r\n            let a = element.find('> a');\r\n            a.append(element.find('> ul > t').remove());\r\n            attrs.$observe('target', value => {\r\n                a.attr('target', value);\r\n            });\r\n        };\r\n        return {\r\n            restrict: 'AE',\r\n            transclude: true,\r\n            replace: true,\r\n            require: '^snMenuItem',\r\n            scope: {\r\n                href: '@',\r\n                uiState: '@',\r\n                readonly: '=',\r\n                uiStateParam: '=',\r\n                uiStateOpts: '=',\r\n                relations: '='\r\n            },\r\n            controller: ctrl,\r\n            compile: (element, attrs, transcludeFn) => {\r\n                let a = element.find('a');\r\n                return {\r\n                    post: link\r\n                }\r\n            },\r\n            template: `<li ng-class=\"{'active': active, 'readonly': readonly, 'hasChildren': children && children.length > 0 }\">\r\n                            <a ng-click=\"gotoState($event)\" ng-href=\"{{readonly ? '' : href}}\">\r\n                                <i class=\"fa fa-angle-right pull-right\"></i>\r\n                            </a>\r\n                            <hr>\r\n                            <ul ng-show=\"children && children.length > 0\" ng-transclude></ul>\r\n                        </li>`\r\n        }\r\n    }]);\r\n\r\n    app.directive('snMenuItem3', [() => {\r\n        let ctrl = function ($scope, $state) {\r\n            $scope.gotoState = stateGoFactory($scope, $state);\r\n        };\r\n        ctrl.$inject = ['$scope', '$state'];\r\n\r\n        let link = function (scope, element, attrs, snMenuItem2, transcludeFn) {\r\n            element.addClass('sn-menu-item3');\r\n            snMenuItem2.addMenu(scope);\r\n            let a = element.find('> a');\r\n            a.append(element.find('> .menu3-detail > t').remove());\r\n            attrs.$observe('target', value => {\r\n                a.attr('target', value);\r\n            });\r\n        }\r\n\r\n        return {\r\n            restrict: 'AE',\r\n            transclude: true,\r\n            replace: true,\r\n            require: '^snMenuItem2',\r\n            scope: {\r\n                href: '@',\r\n                uiState: '@',\r\n                readonly: '=',\r\n                uiStateOpts: '=',\r\n                uiStateParam: '=',\r\n                relations: '='\r\n            },\r\n            controller: ctrl,\r\n            link: link,\r\n            template: `<li ng-class=\"{'active': active, 'readonly': readonly}\">\r\n                            <a ng-click=\"gotoState($event)\" ng-href=\"{{readonly ? '' : href}}\"></a>\r\n                            <div class=\"menu3-detail\" ng-transclude></div>\r\n                        </li>`\r\n        }\r\n    }]);\r\n}"]}